C++ Lock Performance: std::lock_guard vs std::unique_lock vs std::scoped_lock
–ó–∞–ø—É—Å—Ç–∏–≤ 7 —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏—Ö –±–µ–Ω—á–º–∞—Ä–∫—ñ–≤ –ø–æ—Å–ø—ñ–ª—å –Ω–∞ Apple M1, —â–æ–± –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤ C++. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏? –†—ñ–∑–Ω–∏—Ü—ñ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –Ω–µ–º–∞—î.
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ 7 —Ç–µ—Å—Ç—ñ–≤:
–¢–µ—Å—Ç #1: lock_guard üèÜ (35.61s) | scoped_lock +0.67% | unique_lock +1.51%
–¢–µ—Å—Ç #2: unique_lock üèÜ (37.58s) | lock_guard +0.14% | scoped_lock +1.09%
–¢–µ—Å—Ç #3: unique_lock üèÜ (35.87s) | lock_guard +0.28% | scoped_lock +0.30%
–¢–µ—Å—Ç #4: lock_guard üèÜ (35.16s) | scoped_lock +0.46% | unique_lock +0.86%
–¢–µ—Å—Ç #5: scoped_lock üèÜ (35.04s) | lock_guard +0.13% | unique_lock +1.03%
–¢–µ—Å—Ç #6: lock_guard üèÜ (35.30s) | unique_lock +0.44% | scoped_lock +6.00%*
–¢–µ—Å—Ç #7: lock_guard üèÜ (35.17s) | unique_lock +0.44% | scoped_lock +0.74%
*–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π –≤–∏–∫–∏–¥ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏
üí° –í–∏—Å–Ω–æ–≤–æ–∫: –†–Ü–ó–ù–ò–¶–Ü –ù–ï–ú–ê–Ñ
–°–µ—Ä–µ–¥–Ω—è —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è–º–∏: ~0.5-1% - —Ü–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∞ –ø–æ—Ö–∏–±–∫–∞, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è —É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.
–ö–æ–∂–µ–Ω –∑ –Ω–∏—Ö –≤–∏–≥—Ä–∞–≤–∞–≤ —É —Ä—ñ–∑–Ω–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö. –¶–µ –æ–∑–Ω–∞—á–∞—î –æ–¥–Ω–µ: –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä—É—î –º–∞–π–∂–µ —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π –º–∞—à–∏–Ω–Ω–∏–π –∫–æ–¥ –¥–ª—è –≤—Å—ñ—Ö —Ç—Ä—å–æ—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ —É —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó.
üéØ –©–æ —Ä–µ–∞–ª—å–Ω–æ –º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è:
‚ùå –ù–µ –≤–∞–∂–ª–∏–≤–æ: —è–∫–∏–π lock –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (—Ä—ñ–∑–Ω–∏—Ü—è <1%)
‚úÖ –í–∞–∂–ª–∏–≤–æ: –º—ñ–Ω—ñ–º—ñ–∑—É–≤–∞—Ç–∏ —á–∞—Å —É critical section!
